<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for?(:title) ? "#{content_for(:title)} - Drive50" : "Drive50" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="description" content="<%= content_for?(:meta_description) ? content_for(:meta_description) : 'Drive50 helps you track and log your driving practice hours.' %>">

    <%# Open Graph (Facebook, LinkedIn, etc.) %>
    <meta property="og:type" content="website">
    <meta property="og:title" content="<%= content_for?(:meta_title) ? content_for(:meta_title) : 'Drive50' %>">
    <meta property="og:description" content="<%= content_for?(:meta_description) ? content_for(:meta_description) : 'Drive50 helps you track and log your driving practice hours.' %>">
    <meta property="og:url" content="<%= request.base_url + request.fullpath %>">
    <meta property="og:image" content="<%= "#{request.base_url}/images/social-card.png" %>">

    <%# Twitter Card %>
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="<%= content_for?(:meta_title) ? content_for(:meta_title) : 'Drive50' %>">
    <meta name="twitter:description" content="<%= content_for?(:meta_description) ? content_for(:meta_description) : 'Drive50 helps you track and log your driving practice hours.' %>">
    <meta name="twitter:image" content="<%= "#{request.base_url}/images/social-card.png" %>">

    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <% turbo_refreshes_with method: :morph, scroll: :preserve %>

    <link rel="manifest" href="/manifest.json">
    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="<%= 'has-bottom-nav' if authenticated? %>">
    <%= render "shared/header" %>

    <% if authenticated? %>
      <%= turbo_stream_from Current.user %>

      <div id="in-progress-banner-container">
        <%= render "shared/in_progress_banner", in_progress: Current.user.drive_sessions.in_progress.first %>
      </div>

      <%= render "shared/bottom_nav" %>

      <!-- Floating New/Complete Drive button (mobile only, state managed via turbo streams) -->
      <div id="fab-new-drive-wrapper">
        <%= render "shared/fab_new_drive" %>
      </div>
    <% end %>

    <%= render "shared/toasts" %>

    <main>
      <div class="container">
        <%= yield %>
      </div>
    </main>
  </body>
</html>
