<% content_for :title, "Dashboard" %>

<%= turbo_stream_from Current.user %>

<%= render "shared/page_header", title: "Dashboard" %>

<div class="dashboard">
  <%= render partial: "progress_summary", locals: {
    in_progress: @in_progress,
    total_hours: @total_hours,
    night_hours: @night_hours
  } %>

  <section class="drive-history">
    <header>Recent Drives</header>
    <% if Current.user.drive_sessions.completed.any? %>
      <% if mobile_device? %>
        <div class="drive-cards-container">
          <%= render "recent_drives_cards", recent_sessions: @recent_sessions %>
        </div>
      <% else %>
        <table>
          <%= render "table_header" %>
          <tbody id="recent-drives-table">
            <%= render "recent_drives_table", recent_sessions: @recent_sessions %>
          </tbody>
        </table>
      <% end %>
      <% if Current.user.drive_sessions.completed.count > 3 %>
        <div class="view-all-link">
          <%= link_to "View All Drives", all_drive_sessions_path, class: "button" %>
        </div>
      <% end %>
    <% else %>
      <p class="empty-state">No drives recorded yet. Start your first drive!</p>
    <% end %>
  </section>
</div>
