<% content_for :title, "Dashboard" %>

<%= turbo_stream_from Current.user %>

<%= render "shared/page_header", title: "Dashboard" %>

<div class="dashboard">
  <%= render partial: "progress_summary", locals: {
    in_progress: @in_progress,
    total_hours: @total_hours,
    night_hours: @night_hours,
    activity_calendar: activity_calendar_data(@activity_data)
  } %>

  <section class="drive-history">
    <header>Recent Drives</header>
    <% if Current.user.drive_sessions.completed.any? %>
      <table class="recent-drives-table-wrapper">
        <%= render "table_header" %>
        <tbody id="recent-drives-table">
          <%= render partial: "session_row", collection: @recent_sessions, as: :session %>
        </tbody>
      </table>
      <% if Current.user.drive_sessions.completed.count > 3 %>
        <section class="view-all-link">
          <%= link_to "View All Drives", all_drive_sessions_path, class: "button" %>
        </div>
      <% end %>
    <% else %>
      <p class="empty-state">No drives recorded yet. Start your first drive!</p>
    <% end %>
  </section>
</div>
