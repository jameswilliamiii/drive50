# Setting Up Encrypted Credentials

This application uses Rails encrypted credentials instead of environment variables for sensitive configuration.

## Adding Mail and Resend Credentials

To add your Resend API key and mail configuration, run:

```bash
bin/rails credentials:edit
```

This will open your credentials file in your default editor. Add the following structure:

```yaml
# Resend SMTP configuration
resend:
  api_key: your-resend-api-key-here

# Mail configuration
mail:
  from: noreply@drive50.app
  host: drive50.app
```

### Example credentials.yml.enc structure:

```yaml
# Used as the base secret for all MessageVerifiers in Rails, including the one protecting cookies.
secret_key_base: <auto-generated>

# Resend SMTP configuration
resend:
  api_key: re_1234567890abcdef

# Mail configuration
mail:
  from: noreply@example.com
  host: example.com
```

## Important Notes

1. **Never commit `config/master.key`** - This file should be kept secret and not committed to version control
2. **The `config/credentials.yml.enc` file is encrypted** - It's safe to commit this file
3. **For production**, ensure `config/master.key` is securely stored and available to your deployment environment
4. **Development**: If you don't set credentials, the app will use test delivery method (emails won't actually be sent)

## Verifying Credentials

You can verify your credentials are set correctly:

```bash
bin/rails runner "puts Rails.application.credentials.dig(:resend, :api_key)"
bin/rails runner "puts Rails.application.credentials.dig(:mail, :from)"
```

## Production Deployment

For production deployments (e.g., with Kamal), you'll need to:

1. Set the `RAILS_MASTER_KEY` environment variable to the contents of `config/master.key`
2. Or use Kamal's secrets management to inject the master key

The credentials will then be automatically decrypted using the master key.

